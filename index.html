<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kanye Zone</title>
</head>
<body id="body"> 
    <div style="display: flex; justify-content: center; align-items: center; height: 100%; width: 100%; position: absolute; margin: 0px; padding: 0px;">
        <canvas width="100" height="100" id="canvas" style="background-color: #2b2b37; transition: 3s; ">
            
        </canvas>

        <div id="mainContainer" style="position: absolute; transition: 3s;">
            <img id="live-1" src="/assets/head.png" style="width: 35px; height: 35px; position: absolute; right: 20px; top: 20px">
            <img id="live-2" src="/assets/head.png" style="width: 35px; height: 35px; position: absolute; right: 70px; top: 20px">
            <img id="live-3" src="/assets/head.png" style="width: 35px; height: 35px; position: absolute; right: 120px; top: 20px">
            <h1 id="scoreTxt" style="position: relative; top: 100px; font-size: 100px; text-align: center; font-family: Jua; color: white; opacity: 0.3;">0</h1>
    
            <h1 id="W" style="position: absolute; text-align: center; display: none; width: 100%; top: -20px; font-size: 40px; font-family: Jua; color: #ef5fa7; opacity: 0.9; transition: 2s;">W</h1>
            <h1 id="+" style="position: absolute; text-align: center; display: none; width: 100%; top: 10px; left: 20px; font-size: 40px; font-family: Jua; color: #ef5fa7; opacity: 0.9; transition: 2s;">+</h1>
            <h1 id="K" style="position: absolute; text-align: center; display: none; width: 100%; top: 30px; font-size: 40px; font-family: Jua; color: #ef5fa7; opacity: 0.9; transition: 2s;">K</h1>
            
            <div style="display: flex; justify-content: center; ">
                <div style="width: 70%; height: 50px; border-radius: 5px; background-color: #ff8dc637; bottom: 50px; position: absolute; ">
                    <div id="progressBar" style="position: absolute; width: 0%; height: 50px; border-radius: 5px; background-color: #ff8dc6; position: absolute; transition: 2s;">
    
                    </div>
                </div>

                <img src="/assets/Heart.png" style="width: 60px; bottom: 50px; position: absolute; right: 50px;">
                
            </div>


            <div id="LeftSide" style="width: 50%; height: 100%; position: absolute; top: 0px; left: 0px;">

            </div>

            <div id="RightSide" style="width: 50%; height: 100%; position: absolute; top: 0px; right: 0px;">

            </div>
        
        </div>


        <div id="endGameScreen" style="position: absolute; display: none; justify-content: center; align-items: center; flex-direction: column; ">
            <img src="/assets/deathHead.png" style="width: 200px; height: 300px;">
            <img onclick="location.href ='/' " src="/assets/retryBtn.png" style="width: 200px; height: 50px; cursor: pointer; margin-top: 30px;">
        </div>

        <div id="WinGameScreen" style="position: absolute; display: none; justify-content: center; align-items: center; flex-direction: column; ">
            <img src="/assets/winHead.png" style="width: 400px; height: 300px;">
            <img id="winTxt" onclick="window.open('https://mattchong.squarespace.com/a-love-letter-to-wk', '_blank') " src="/assets/winTxt.png" style="width: 400px; height: 50px; cursor: pointer; margin-top: 30px; transition: 0.5; opacity: 0;">
        </div>


    </div>
</body>
<script>

    const canvas = document.getElementById('canvas')
    const ctx = canvas.getContext('2d')

    var cWidth = canvas.width;
    var cHeight = canvas.height;
    
    // game variables
    var angleDegrees = 0
    var angleRad = 0
    var circleMoveSpeed = 5
    var circleMoveDirection = 'none'
    const letterSpeed = 1.5
    var score=0;
    var goodLettersList = []
    var liveCount = 3
    var isRunning = true
    var flyingLetters = []

    var headImg = document.createElement('img');
    var handImg = document.createElement('img');
    var nikeHeadImg = document.createElement('img');
    var nikeHandImg = document.createElement('img')
    var amazonHeadImg = document.createElement('img')

    var nikeImg = document.createElement('img');
    var amazonImg = document.createElement('img');

    var nikePowerActivated = false
    var amazonPowerActivated= false

    function init()
    {
        canvas.width = window.innerWidth
        canvas.height = window.innerHeight

        document.getElementById('mainContainer').style.width = innerWidth + 'px'
        document.getElementById('mainContainer').style.height = innerHeight + 'px'

        document.getElementById('endGameScreen').style.width = innerWidth + 'px'
        document.getElementById('endGameScreen').style.height = innerHeight + 'px'

        update()

        document.getElementById('body').setAttribute('onclick', "{document.getElementById('body').requestFullscreen(); screen.orientation.lock('landscape'); document.getElementById('body').setAttribute('onclick', '')}; canvas.width = window.innerWidth; canvas.height = window.innerHeight" )

        headImg.src = './assets/head.png'
        handImg.src = './assets/hand.png'
        nikeHeadImg.src = './assets/nikeHead.png'
        nikeHandImg.src = './assets/nikeHand.png'
        amazonHeadImg.src = './assets/amazonHead.png'

        nikeImg.src = './assets/nikeLogoWhite.png'
        amazonImg.src = './assets/amazonLogoWhite.png'

        // flyingLetters.push(new letter('W', 20,20))
        intervalSpawnLetters()
        // intervalSpawnLetters()
    }

    function normalizeAngle(angleDegrees) {
            // Normalize the angle to be within the range of 0 to 360 degrees
            var a = angleDegrees % 360;

            // Ensure the result is positive
            if (a < 0) {
                a += 360;
            }

            return a
            }

    function update()
    {
        if(isRunning == false) {return}
        ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

        // Set the center point and radius for the circle
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        // Draw the circle
        ctx.beginPath();
        // ctx.arc(centerX, centerY, 60, 0, Math.PI * 2);
        // ctx.fillStyle = '#9797d3';
        ctx.fill();
        ctx.closePath();
        
        if(nikePowerActivated) 
        {
            ctx.drawImage(nikeHeadImg, centerX-30, centerY-55, 60, 110)
            circleMoveSpeed = 5 * 1.3

        }else if(amazonPowerActivated){
            ctx.drawImage(amazonHeadImg, centerX-55, centerY-55, 110, 110)
        }else{
            ctx.drawImage(headImg, centerX-55, centerY-55, 110, 110)
        }

        // Draw the ring

        if(circleMoveDirection == 'right')
        {
            moveCircle(circleMoveSpeed, 1)
        }else if (circleMoveDirection == 'left')
        {
            moveCircle(circleMoveSpeed, -1)
        }


        ctx.translate(centerX, centerY)
        ctx.rotate(angleRad)
        ctx.translate(-centerX, -centerY)
        ctx.beginPath();
        // ctx.arc(centerX, centerY, 75, 8/2, Math.PI * 2);
        if(nikePowerActivated)
        {
            ctx.drawImage(nikeHandImg, centerX-(110/2), centerY-150, 110, 60)
        }else{
            ctx.drawImage(handImg, centerX-(75/2), centerY-150, 75, 80)
        }
        ctx.strokeStyle = '#c6605c';
        ctx.lineWidth = 5;
        ctx.stroke();
        ctx.closePath();
        ctx.translate(centerX, centerY)
        ctx.rotate(-angleRad)
        ctx.translate(-centerX, -centerY)
        
        

        flyingLetters.forEach((l, i) => {
            var xd = 0
            var yd = 0
            
            // Calculate the distance between current position and the center
            var dx = centerX - l.posX;
            var dy = centerY - l.posY;
            var distance = Math.sqrt(dx * dx + dy * dy);

            // Normalize the direction vector
            var directionX = dx / distance;
            var directionY = dy / distance;

            l.posX += directionX * letterSpeed
            l.posY += directionY * letterSpeed
            
            var angleApproachingRad = Math.atan2(dy, dx);
            var angleApproachingDeg = angleApproachingRad * (180 / Math.PI);
            angleApproachingDeg = angleApproachingDeg - 90

            angleApproachingDeg = normalizeAngle(angleApproachingDeg)

            var centerAngleRing = angleDegrees 
            
            centerAngleRing = normalizeAngle(centerAngleRing)
            
            // console.log('approaching anlge nomralise: ' + angleApproachingDeg)
            // console.log('hand angle normalised: ' + centerAngleRing)

            // console.log('left bound: ' +  normalizeAngle((centerAngleRing-50)))
            // console.log('right bound: ' +  (centerAngleRing+50))

            var redConnect = false
            // if(angleApproachingDeg > normalizeAngle((centerAngleRing-50)) && angleApproachingDeg < (centerAngleRing+360+50))
            // {
            //     redConnect = true
            //     console.log('red will connect')
            // }
            // if(angleApproachingDeg > normalizeAngle((centerAngleRing-50)) && angleApproachingDeg < (centerAngleRing+50))
            // {
            //     redConnect = true
            //     console.log('red will connect')
            // }
            function isAngleInRange(angle, targetAngle, range) {
                // Normalize angles to be between 0 and 360 degrees
                angle = (angle + 360) % 360;
                targetAngle = (targetAngle + 360) % 360;

                // Calculate the lower and upper bounds of the range
                const lowerBound = (targetAngle - range + 360) % 360;
                const upperBound = (targetAngle + range - 25) % 360;


                // console.log(upperBound)

                // Check if the angle falls within the range
                if (lowerBound < upperBound) {
                    return angle >= lowerBound && angle <= upperBound;
                } else {
                    // Range wraps around 0 degrees, so we need to check two ranges
                    return angle >= lowerBound || angle <= upperBound;
                }
            }
            // console.log(centerAngleRing)
            // console.log('Angle approaching center:', angleApproachingDeg);

            if(nikePowerActivated)
            {
                redConnect =isAngleInRange(angleApproachingDeg, centerAngleRing, 70)
            }else{
                redConnect =isAngleInRange(angleApproachingDeg, centerAngleRing, 50) 
            }
            // console.log(redConnect)

            var range = 65

            if(redConnect) {
                range = 150
                if(nikePowerActivated)
                {
                    range = 200
                }
            }
            
            if(l.posX - (canvas.clientWidth /2) < range && l.posX - (canvas.clientWidth /2) > -range)
            {
                if(l.posY - (canvas.clientHeight /2) < range && l.posY - (canvas.clientHeight /2) > -range)
                {
                    // console.log('center')
                    center = true
                    flyingLetters.splice(i, 1)
                    if(redConnect == true)
                    {
                        console.log('Blocked item from entering')
                    }else{
                        console.log('Item Enterd')
                        if(!amazonPowerActivated)
                        {

                            if(l.letter == 'W' || l.letter == '+' || l.letter == 'K')
                            {
                                updateGoodLetters(l.letter)
                                updateScore(1)
                            }else if (l.letter == 'Amazon' || l.letter == 'Nike')
                            {
                                runPowerup(l.letter)
                            }else{
                                updateScore(-1)
                            }
                        }else{
                            console.log('AMAZON BLOCK')
                            amazonPowerActivated = false
                        }
                    }
                }
            }
            
            l.draw()
        });

        
        requestAnimationFrame(update)
    }
    
    class letter {
        constructor(letter, posX, posY, rotation) {
            this.letter = letter
            this.posX = posX
            this.posY = posY
            this.rotation = rotation
        }

        draw()
        {
            ctx.beginPath()
            ctx.translate(this.posX, this.posY)
            ctx.rotate(this.rotation)
            ctx.translate(-this.posX, -this.posY)
            if(this.letter == 'Amazon' || this.letter == 'Nike')
            {
                if(this.letter == 'Amazon')
                {
                    ctx.drawImage(amazonImg, this.posX, this.posY, 100, 70)
                }
                if(this.letter == 'Nike')
                {
                    ctx.drawImage(nikeImg, this.posX, this.posY, 50, 20)
                }
            }else{
                ctx.font = "48px Jua";
                ctx.fillStyle = 'white'
                ctx.fillText(this.letter, this.posX, this.posY,)
            }
            ctx.translate(this.posX, this.posY)
            ctx.rotate(-this.rotation)
            ctx.translate(-this.posX, -this.posY)
        }
    }

    function runPowerup(powerUp)
    {
        if(nikePowerActivated) {return}
        if(amazonPowerActivated) {return}

        if(powerUp == 'Nike')
        {
            nikePowerActivated = true

            setTimeout(() => {
                // after 8 seconds of nike powerup
                nikePowerActivated = false

            }, 8000);
        }
        if(powerUp == 'Amazon')
        {
            if(amazonPowerActivated) {return}
            amazonPowerActivated = true
        }
    }

    function updateScore(incrementValue)
    {
        score += incrementValue
        document.getElementById('scoreTxt').innerHTML = score

        if(incrementValue == -1)
        {
            // loose live
            document.getElementById('live-' + liveCount).style.display = 'none'
            liveCount -= 1

            if(liveCount == 0)
            {
                isRunning = false
                document.getElementById('canvas').style.opacity = 0
                document.getElementById('mainContainer').style.opacity = 0

                setTimeout(() => {
                    document.getElementById('endGameScreen').style.display = 'flex'
                }, 3000);
            }

        }

    }
    function updateGoodLetters(letter)
    {
        var foundLetter = false
        goodLettersList.forEach((l) => {
            if(l == letter)
            {
                foundLetter = true
            }
        })

        if(!foundLetter)
        {
            goodLettersList.push(letter)
            document.getElementById(letter).style.display = 'block'

            if(goodLettersList.length == 3)
            {
                setTimeout(() => {
                
                    goodLettersList.forEach((l)=>{
                        document.getElementById(l).style.top = (JSON.parse(document.getElementById(l).style.top.split('px')[0]) - 100) + 'px'
                    })

                    // update progress bar
                    if(document.getElementById('progressBar').style.width.split('%')[0] < 99)
                    {
                        var currentPercentage = JSON.parse(document.getElementById('progressBar').style.width.split('%')[0])
                        document.getElementById('progressBar').style.width = ((currentPercentage += 100/3) + '%')
                    }

                    if(JSON.parse(document.getElementById('progressBar').style.width.split('%')[0]) > 99)
                    {
                        // alert('You Win')
                        isRunning = false
                    }

                    setTimeout(() => {
                        goodLettersList.forEach((l)=>{
                        document.getElementById(l).style.top = (JSON.parse(document.getElementById(l).style.top.split('px')[0]) + 100) + 'px'
                        document.getElementById(l).style.display = 'none'
                        goodLettersList = []


                    })
                    if(isRunning == false)
                    {
                        // game win
                        document.getElementById('canvas').style.opacity = 0
                        document.getElementById('mainContainer').style.opacity = 0

                        setTimeout(() => {
                            document.getElementById('WinGameScreen').style.display = 'flex'
                            document.getElementById('winTxt').style.opacity = 1
                        }, 3000);

                    }
                    }, 1000);

                }, 500);
            }
        }
        




        // document.getElementById('goodLetters').innerHTML += ' ' + letter 
    }
    function randomWholeNumber(start, end) {
    return Math.floor(Math.random() * (end - start + 1)) + start;
}
    
    function intervalSpawnLetters()
    {
        const lettersList = ['W', '+', 'K', 'L', 'Amazon', 'Nike']
        flyingLetters.push(new letter(lettersList[randomWholeNumber(0, lettersList.length-1)], randomWholeNumber(0,canvas.clientWidth),randomWholeNumber(0, canvas.clientHeight), randomWholeNumber(0, 360)))
        setTimeout(() => {
            intervalSpawnLetters()
        }, 2000);
    }

    function moveCircle(distance, direction)
    {
        angleDegrees += distance * direction
        angleRad = angleDegrees * (Math.PI/180)
    }

    function events()
    {
        addEventListener('keydown', (e) => {
            // console.log(e)
            const key = e.key
            // console.log(key)
            if(key == 'ArrowRight' || key == 'd')
            {
                // console.log('move right')
                // moveCircle(circleMoveRateDistance, 1)
                circleMoveDirection = 'right'
            }
            if(key == 'ArrowLeft' || key == 'a')
            {
                // console.log('move left')
                // moveCircle(circleMoveRateDistance, -1)
                circleMoveDirection = 'left'
            }
        })

        addEventListener('keyup', (e) => {
            const key = e.key
            if(key == 'ArrowRight' || key == 'd')
            {
                if(circleMoveDirection == 'right')
                {
                    circleMoveDirection = 'none'
                }
            }
            if(key == 'ArrowLeft' || key == 'a')
            {
                if(circleMoveDirection == 'left')
                {
                    circleMoveDirection = 'none'
                }
            }
        })


        document.getElementById('LeftSide').ontouchstart = () => {
            circleMoveDirection = 'left'
        }
        document.getElementById('RightSide').ontouchstart = () => {
            circleMoveDirection = 'right'
        }

        document.getElementById('LeftSide').ontouchend = () => {
            if(circleMoveDirection == 'left')
            {
                circleMoveDirection = 'none'
            }
        }
        document.getElementById('RightSide').ontouchend = () => {
            if(circleMoveDirection == 'right')
            {
                circleMoveDirection = 'none'
            }
        }


        addEventListener('resize', (event) => {
            canvas.width = innerWidth
            canvas.height = innerHeight

            cWidth = canvas.width
            cHeight = canvas.height

            document.getElementById('mainContainer').style.width = innerWidth + 'px'
            document.getElementById('mainContainer').style.height = innerHeight + 'px'

            document.getElementById('endGameScreen').style.width = innerWidth + 'px'
            document.getElementById('endGameScreen').style.height = innerHeight + 'px'
        })

        
    }
    init()
    events()
</script>
</html>

<style>
    body{
        margin: 0px;
        padding: 0px;
        overflow: hidden;
        background-color: #48485f;
    }
</style>

